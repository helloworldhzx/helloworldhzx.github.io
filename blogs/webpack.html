<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack | zz的blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="用于记录前端知识总结">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.8be25012.css" as="style"><link rel="preload" href="/assets/js/app.243d9624.js" as="script"><link rel="preload" href="/assets/js/3.76c4d218.js" as="script"><link rel="preload" href="/assets/js/1.7654875a.js" as="script"><link rel="preload" href="/assets/js/13.6e4b38fe.js" as="script"><link rel="prefetch" href="/assets/js/10.570f14fb.js"><link rel="prefetch" href="/assets/js/11.8c7892f9.js"><link rel="prefetch" href="/assets/js/12.b8c48a73.js"><link rel="prefetch" href="/assets/js/14.4f865755.js"><link rel="prefetch" href="/assets/js/15.9621c86f.js"><link rel="prefetch" href="/assets/js/16.6b1473f0.js"><link rel="prefetch" href="/assets/js/17.1ec85fc5.js"><link rel="prefetch" href="/assets/js/18.9bb49ee9.js"><link rel="prefetch" href="/assets/js/4.dbcfaa7d.js"><link rel="prefetch" href="/assets/js/5.869862b6.js"><link rel="prefetch" href="/assets/js/6.4f01bf44.js"><link rel="prefetch" href="/assets/js/7.f8c9394d.js"><link rel="prefetch" href="/assets/js/8.c6fc639c.js"><link rel="prefetch" href="/assets/js/9.217370de.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8be25012.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-1156296a><div data-v-1156296a><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1156296a data-v-1156296a><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4e82dffc data-v-1156296a data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>zz的blog</h3> <p class="description" data-v-4e82dffc data-v-4e82dffc>用于记录前端知识总结</p> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>zz</span>
            
          <!---->
          2021
        </a></span></div></div> <div class="hide" data-v-1156296a><header class="navbar" data-v-1156296a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="zz的blog" class="logo"> <span class="site-name">zz的blog</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/node/" class="nav-link"><i class="undefined"></i>
  node
</a></li><li class="dropdown-item"><!----> <a href="/categories/面试题/" class="nav-link"><i class="undefined"></i>
  面试题
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      其他
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/helloworldhzx" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1156296a></div> <aside class="sidebar" data-v-1156296a><div class="personal-info-wrapper" data-v-828910c6 data-v-1156296a><img src="/avatar.png" alt="author-avatar" class="personal-img" data-v-828910c6> <h3 class="name" data-v-828910c6>
    zz
  </h3> <div class="num" data-v-828910c6><div data-v-828910c6><h3 data-v-828910c6>8</h3> <h6 data-v-828910c6>Articles</h6></div> <div data-v-828910c6><h3 data-v-828910c6>3</h3> <h6 data-v-828910c6>Tags</h6></div></div> <ul class="social-links" data-v-828910c6></ul> <hr data-v-828910c6></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/node/" class="nav-link"><i class="undefined"></i>
  node
</a></li><li class="dropdown-item"><!----> <a href="/categories/面试题/" class="nav-link"><i class="undefined"></i>
  面试题
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      其他
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/helloworldhzx" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>node</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blogs/node.html" class="sidebar-link">node</a></li><li><a href="/blogs/mongodb.html" class="sidebar-link">mongodb</a></li><li><a href="/blogs/webpack.html" aria-current="page" class="active sidebar-link">webpack</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>interview</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4e82dffc data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>webpack</h3> <!----> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>zz</span>
            
          <!---->
          2021
        </a></span></div></div> <div data-v-1156296a><main class="page" style="padding-right:0;"><section><div class="page-title"><h1 class="title">webpack</h1> <div data-v-1ff7123e><i class="iconfont reco-account" data-v-1ff7123e><span data-v-1ff7123e>zz</span></i> <i class="iconfont reco-date" data-v-1ff7123e><span data-v-1ff7123e>6/23/2021</span></i> <i class="iconfont reco-eye" data-v-1ff7123e><span id="/blogs/webpack.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-1ff7123e><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <!----></div></div> <div class="theme-reco-content content__default"><h2 id="安装上手"><a href="#安装上手" class="header-anchor">#</a> 安装上手</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm init -y // 生成package.json文件
npm i webpack webpack-cli --save-dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>P.S. webpack 是 Webpack 的核心模块，webpack-cli 是 Webpack 的 CLI 程序，用来在命令行中调用 Webpack。</p></blockquote> <p>安装完成之后，webpack-cli 所提供的 CLI 程序就会出现在 node_modules/.bin 目录当中，我们可以通过 npx 快速找到 CLI 并运行它，具体操作如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npx webpack --version
4.43.0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>P.S. npx 是 npm 5.2 以后新增的一个命令，可以用来更方便的执行远程模块或者项目 node_modules 中的 CLI 程序。</p></blockquote> <p>直接运行 webpack 命令来打包 JS 模块代码</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npx webpack
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>将webpack启动配置到package的scripts中</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&quot;scripts&quot;: {
    &quot;build&quot;: &quot;webpack&quot;
  },
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="devserver配置"><a href="#devserver配置" class="header-anchor">#</a> devServer配置</h2> <p>用来自动化（自动编译，自动打开浏览器，自定刷新浏览器等）
特点： 只会在内存中编辑打包，不会有任何输出
启动devServer指令为： npx webpack-dedv-server</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>module.exports = {
  devServer: {
      contentBase: resolve(__dirname,'build'),
      compress： true // 启动gzip压缩
      port: 3000,
      open: true, //自动打开浏览器
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="自定义配置webpack"><a href="#自定义配置webpack" class="header-anchor">#</a> 自定义配置webpack</h2> <p>之前打包使用的是webpack的默认配置，可以添加webpack.config.js文件自定义配置。<br>
webpack.config.js 是一个运行在 Node.js 环境中的 JS 文件，我们需要按照 CommonJS的方式编写代码</p> <p>指定打包入口和出口</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>const path = require('path')
module.exports = {
  entry: './src/index.js',
  output: {
    filename: 'bundle.js',
    path: path.join(__dirname, 'output')
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="让配置文件支持智能提示"><a href="#让配置文件支持智能提示" class="header-anchor">#</a> 让配置文件支持智能提示</h2> <p>VSCode 对于代码的自动提示是根据成员的类型推断出来的，通过 import 的方式导入 Webpack 模块中的 Configuration类型，然后根据类型注释的方式将变量标注为这个类型，这样我们在编写这个对象的内部结构时就可以有正确的智能提示了</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// ./webpack.config.js
import { Configuration } from 'webpack'

/**
 * @type {Configuration}
 */
const config = {
  entry: './src/index.js',
  output: {
    filename: 'bundle.js'
  }
}

module.exports = config

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><blockquote><p>P.S. 在编写配置时才需要，打包时需要注释掉，commonJs不支持import写法会报错。另外需要定义变量保存不能直接module.exports = {}，不然提示不生效</p></blockquote> <h2 id="webpack工作模式"><a href="#webpack工作模式" class="header-anchor">#</a> webpack工作模式</h2> <p><a href="https://webpack.docschina.org/concepts/mode/" target="_blank" rel="noopener noreferrer">mode<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 配置选项，告知 webpack 使用相应环境的内置优化</p> <table><thead><tr><th>选项</th> <th>描述</th></tr></thead> <tbody><tr><td>development</td> <td>启用 NamedChunksPlugin 和 NamedModulesPlugin</td></tr> <tr><td>production</td> <td>启用 FlagDependencyUsagePlugin,FlagIncludedChunksPlugin等插件</td></tr> <tr><td>none</td> <td>退出任何默认优化选项</td></tr></tbody></table> <p>配置mode的方式有两种：</p> <ul><li>webpack.config.js上配置mode属性</li> <li>通过CLI --mode=xxx 传入参数</li></ul> <h2 id="loader"><a href="#loader" class="header-anchor">#</a> loader</h2> <p>webpack 只能理解 JavaScript 和 JSON 文件。loader 让 webpack 能够去处理其他类型的文件，并将它们转换为有效 模块，以供应用程序使用，以及被添加到依赖图中。
<img src="/assets/img/loader.7508ba78.png" alt="loader执行顺序"></p> <h3 id="打包css样式资源"><a href="#打包css样式资源" class="header-anchor">#</a> 打包css样式资源</h3> <p>不配置loader直接使用css文件是打包报错的,需要配置css-loader</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install css-loader --save-dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>module: {
    rules:[{
      test:/\.css$/, // 根据打包过程中所遇到文件路径匹配是否使用这个 loader
      use: &quot;css-loader&quot; // 指定具体的 loader
    }]
  }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>在配置对象的 module 属性中添加一个 rules 数组。这个数组就是我们针对资源模块的加载规则配置，其中的每个规则对象都需要设置两个属性：</p> <ul><li>test 属性，它是一个正则表达式，用来匹配打包过程中所遇到文件路径，这里我们是以 .css 结尾;</li> <li>use 属性，它用来指定匹配到的文件需要使用的 loader，这里用到的是 css-loader</li></ul> <p>只配置css-loader时只是把css转成js代码，内容是样式字符串，需要在 css-loader 的基础上再使用一个 style-loader，把 css-loader 转换后的结果通过 style 标签追加到页面上。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install style-loader --save-dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>module: {
    rules:[{
      test:/\.css$/,
      use: [&quot;style-loader&quot;,&quot;css-loader&quot;]
    }]
  }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>P.S 有多个loader时是从右到左执行，需要注意loader之间的顺序</p></blockquote> <h3 id="打包图片资源"><a href="#打包图片资源" class="header-anchor">#</a> 打包图片资源</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install url-loader --save-dev

// webpack.config.js
module: {
    rules: [{
    // 处理不了HTML中img图片
    test: /\.(png|jpg|gif)$/i,
      use: [{
      // 需要下载url-loader、file-loader,url-loader依赖file-loader
        loader: 'url-loader',
        options: {
        // 图片大小小于8kb，就会被base64处理
        // 优点：减少请求次数（减轻服务器压力）
        // 缺点：图片体积会增大（文件请求速度更慢）
          limit: 8*1024,
          // 打包是根据esmodule还是commonjs进行打包
          esModule: false,
          // 文件重命名
          // [hash:10] 取hash前10位
          // [ext] 文件原来的后缀
          name: '[hash:10].[ext]',
          outputPath: 'img' // 打包到img文件夹下
        },
        }],
    }],
  }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>当HTML中有img标签引入图片时，url-loader处理不了，需要html-loader</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm i html-loader --save-dev

// webpack.config.js
module: {
    rules: [{
      test: /\.(png|jpg|gif)$/i,
      use: [{
        loader: 'url-loader',
        options: {
          limit: 8*1024
        },
      }],
    },{
        test:/\.html$/,
        use:[{
            loader:'html-loader'
        }]
    }],
  }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><blockquote><p>P.S. html-loader是将HTML导出为字符串，默认情况下，每个可加载属性（例如- <img src="image.png">）都将导入（const img = require('./image.png')或import img from &quot;./image.png&quot;&quot;)
将img里的图片通过模块引入，从而能被url-loader处理</p></blockquote> <h3 id="其他资源file-loader"><a href="#其他资源file-loader" class="header-anchor">#</a> 其他资源file-loader</h3> <h3 id="css兼容性postcss-loader"><a href="#css兼容性postcss-loader" class="header-anchor">#</a> css兼容性postcss-loader</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code> rules:[{
      test:/\.css$/,
      use: [
        MiniCssExtractPlugin.loader,
        &quot;css-loader&quot;,
        // postcss-preset-env帮postcss找到package.json中browserslist里面的配置，通过配置加载指定的兼容性
        {
            loader: &quot;postcss-loader&quot;,
            options: {
                ident: &quot;postcss&quot;,
                plugins: ()=&gt;{
                    require(&quot;postcss-preset-env&quot;)()
                }
            }
        }
      ]
    }]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="mini-css-extract-plugin打包单独的css文件"><a href="#mini-css-extract-plugin打包单独的css文件" class="header-anchor">#</a> mini-css-extract-plugin打包单独的css文件</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install --save-dev mini-css-extract-plugin

module: {
    rules:[{
      test:/\.css$/,
      use: [
        // 创建style标签，引入样式
        // &quot;style-loader&quot;,
        // 取代style-lodaer, 将css生成单独的文件再引入
        MiniCssExtractPlugin.loader,
        &quot;css-loader&quot;
      ]
    }]
  },
  plugins:[
    new MiniCssExtractPlugin()
  ]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="optimize-css-assets-webpack-plugin-压缩css文件"><a href="#optimize-css-assets-webpack-plugin-压缩css文件" class="header-anchor">#</a> optimize-css-assets-webpack-plugin 压缩css文件</h3> <h3 id="js兼容性处理-转换成es5代码-babel-loader"><a href="#js兼容性处理-转换成es5代码-babel-loader" class="header-anchor">#</a> js兼容性处理  转换成es5代码 babel-loader</h3> <p>js兼容性处理 babel-loader @babel/core @babel/preset-env</p> <ol><li>基础的js处理--&gt; @babel/preset-env
问题：只能处理基础的js问题，不能转换promise等</li> <li>全部js兼容性处理--&gt; @babel/polyfill
问题：会把所有兼容性问题都转换，很多不需要用到，增大文件体积</li> <li>处理需要做兼容性问题的-按需加载--&gt; core-js</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>module: {
    rules:[{
        test:/\.js$/,
        exclude: /node_modules/,
        loader: 'babel-loader',
        options: {
        //预设：指定babel做怎么样的兼容性处理
          presets:[
            [
             &quot;@babel/preset-env&quot;,
             {
               //按需加载
                 useBuiltIns: &quot;usage&quot;,
                 // 指定corejs版本
                 corejs:{
                     version: 3
                 }，
                 //指定兼容性做到哪个版本浏览器
                 targets:{
                     chrome:60,
                     ie:9
                 }
             }
            ]
          ]
      },
    }]
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="js语法检查eslint"><a href="#js语法检查eslint" class="header-anchor">#</a> js语法检查eslint</h3> <p>语法检查 eslint-loader eslint<br>
注意只检查自己代码，不用检查第三方库<br>
设置检查规则：package.json中eslintConfig中设置,也能配置单独文件.eslintrc<br> <code>&quot;eslintConfig&quot;:{&quot;extends&quot;:&quot;airbnb-base&quot;}</code><br>
需要安装 eslint-config-airbnb-base eslint-plugin-import eslint</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>module: {
    rules:[{
        test:/\.js$/,
        exclude: /node_modules/,
        loader: 'eslint-loader',
        options: {
          fix: true, // 打包时自动修复
      },
    }]
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p>P.S 打包时console会警告，可以在使用console代码前加一句注释<code>// eslint-disable-next-line</code></p></blockquote> <h2 id="插件plugin"><a href="#插件plugin" class="header-anchor">#</a> 插件plugin</h2> <p>插件用于执行范围更广的任务。包括：打包优化，资源管理，注入环境变量。</p> <p>几个插件最常见的应用场景：</p> <ul><li>实现自动在打包之前清除 dist 目录（上次的打包结果）；</li> <li>自动生成应用所需要的 HTML 文件；</li> <li>根据不同环境为代码注入类似 API 地址这种可能变化的部分；</li> <li>拷贝不需要参与打包的资源文件到输出目录；</li> <li>压缩 Webpack 打包完成后输出的文件；</li> <li>自动发布打包结果到服务器实现自动部署。</li></ul> <h3 id="clean-webpack-plugin用来自动清除输出目录的插件"><a href="#clean-webpack-plugin用来自动清除输出目录的插件" class="header-anchor">#</a> clean-webpack-plugin用来自动清除输出目录的插件</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install clean-webpack-plugin --save-dev

// ./webpack.config.js
const { CleanWebpackPlugin } = require('clean-webpack-plugin')
module.exports = {
  ...其他配置
  plugins: [
    new CleanWebpackPlugin()
  ]
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="html-webpack-plugin用来生成html页面-自动引入打包后的js-css不需要手动修改"><a href="#html-webpack-plugin用来生成html页面-自动引入打包后的js-css不需要手动修改" class="header-anchor">#</a> html-webpack-plugin用来生成html页面，自动引入打包后的js，css不需要手动修改</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ npm install html-webpack-plugin --save-dev
// ./webpack.config.js
const HtmlWebpackPlugin = require('html-webpack-plugin')
const { CleanWebpackPlugin } = require('clean-webpack-plugin')

module.exports = {
  ...其他配置
  plugins: [
    new CleanWebpackPlugin(),
    new HtmlWebpackPlugin()
  ]
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>当需要修改title名称或一些 meta 标签等少量东西可以往HtmlWebpackPlugin传入对象进行配置</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>new HtmlWebpackPlugin({
      title: 'zz',
      meta: {
        viewport: 'width=device-width'
      }
    })
打包实际输出为如下
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;zz&lt;/title&gt;
  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width&quot;&gt;&lt;/head&gt;
  &lt;body&gt;
  &lt;script src=&quot;bundle.js&quot;&gt;&lt;/script&gt;&lt;/body&gt;
&lt;/html&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>若需要对 HTML 进行大量的自定义，可以使用HTML模板</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// ./webpack.config.js
const HtmlWebpackPlugin = require('html-webpack-plugin')
const { CleanWebpackPlugin } = require('clean-webpack-plugin')

module.exports = {
  ...其他配置
  plugins: [
    new CleanWebpackPlugin(),
    new HtmlWebpackPlugin({
      title: 'zz',
      template: './src/index.html' //HTML模板
    })
  ]
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>打包生成多个html文件,只需在创建一个HtmlWebpackPlugin对象</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>module.exports = {
  ...其他配置
  plugins: [
    new CleanWebpackPlugin(),
    new HtmlWebpackPlugin({
      title: 'zz',
      template: './index.html' //HTML模板
    }),
    new HtmlWebpackPlugin({
      filename:&quot;zz.html&quot;,
      title: 'zz',
      template: './index.html' //HTML模板
    })
  ]
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="copy-webpack-plugin用于复制文件"><a href="#copy-webpack-plugin用于复制文件" class="header-anchor">#</a> copy-webpack-plugin用于复制文件</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ npm install copy-webpack-plugin --save-dev
// ./webpack.config.js
const CopyWebpackPlugin = require('copy-webpack-plugin')

module.exports = {
  plugins: [
    new CopyWebpackPlugin([
      'public' // 需要拷贝的目录或者路径通配符
    ])
  ]
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="mini-css-extract-plugin打包单独的css文件-2"><a href="#mini-css-extract-plugin打包单独的css文件-2" class="header-anchor">#</a> mini-css-extract-plugin打包单独的css文件</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install --save-dev mini-css-extract-plugin

module: {
    rules:[{
      test:/\.css$/,
      use: [
        // 创建style标签，引入样式
        // &quot;style-loader&quot;,
        // 取代style-lodaer, 将css生成单独的文件再引入
        MiniCssExtractPlugin.loader,
        &quot;css-loader&quot;
      ]
    }]
  },
  plugins:[
    new MiniCssExtractPlugin()
  ]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="optimize-css-assets-webpack-plugin-压缩css文件-2"><a href="#optimize-css-assets-webpack-plugin-压缩css文件-2" class="header-anchor">#</a> optimize-css-assets-webpack-plugin 压缩css文件</h3> <h3 id="js、html代码压缩"><a href="#js、html代码压缩" class="header-anchor">#</a> js、html代码压缩</h3> <p>js压缩使用UglifyJsPlugin插件压缩，生产环境默认带有UglifyJsPlugin插件
html压缩在HtmlWebpackPlugin插件添加minify参数</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>new HtmlWebpackPlugin({
      template: './index.html',
      minify: {
          //移除空格但是不会删除SCRIPT、style和textarea中的空格
          collapseWhitespace: true,
          //移除注释 但是会保留script和style中的注释
          removeComments: true,
          // 删除多余的属性
          removeRedundantAttributes: true,
          // 删除script的类型属性，在h5下面script的type默认值：text/javascript
          removeScriptTypeAttributes: true,
          // 删除style的类型属性，同上
          removeStyleLinkTypeAttributes: true,
          // 用short (HTML5) doctype替换doctype
          useShortDoctype: true
      }
    }),
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="编写一个自己的markdown-loader"><a href="#编写一个自己的markdown-loader" class="header-anchor">#</a> 编写一个自己的markdown-loader</h2> <p>添加一个markdown-loader.js文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// ./markdown-loader.js
module.exports = source =&gt; {
  // 加载到的模块内容 =&gt; '# About\n\nthis is a markdown file.'
  console.log(source)
  // 返回值就是最终被打包的内容
  return 'hello loader ~'
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>在webpack.config.js文件配置</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>module: {
    rules: [
      {
        test: /\.md$/,
        // 直接使用相对路径
        use: './markdown-loader'
      }
    ]
  }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>现在打包会报错，因为 Webpack加载资源文件的过程类似于一个工作管道，你可以在这个过程中依次使用多个 Loader，但是最终这个管道结束过后的结果必须是一段标准的 JS 代码字符串。
<img src="/loader.png" alt="loader"></p> <p>解决的办法</p> <ul><li>直接在这个 Loader 的最后返回一段 JS 代码字符串</li> <li>再找一个合适的加载器，在后面接着处理我们这里得到的结果。</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>// ./markdown-loader.js
const marked = require('marked')

module.exports = source =&gt; {
  // 1. 将 markdown 转换为 html 字符串
  const html = marked(source)
  // 2. 将 html 字符串拼接为一段导出字符串的 JS 代码
  const code = `module.exports = ${JSON.stringify(html)}`
  return code 
  // code =&gt; 'export default &quot;&lt;h1&gt;About&lt;/h1&gt;&lt;p&gt;this is a markdown file.&lt;/p&gt;&quot;'
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>多个loader，直接返回html，再由html-loader处理返回js代码</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// ./markdown-loader.js
const marked = require('marked')

module.exports = source =&gt; {
  // 1. 将 markdown 转换为 html 字符串
  const html = marked(source)
  return html
}

// webpack-config.js 注意loader顺序
 module: {
    rules: [
      {
        test: /\.md$/,
        use: [
          'html-loader',
          './markdown-loader'
        ]
      }
    ]
  }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="编写一个自己的插件plugin-删除bundle里的-注释"><a href="#编写一个自己的插件plugin-删除bundle里的-注释" class="header-anchor">#</a> 编写一个自己的插件plugin  删除bundle里的/***/注释</h2> <p>Webpack 要求我们的插件必须是一个函数或者是一个包含 apply 方法的对象，一般我们都会定义一个类，在这个类中定义 apply 方法。然后在使用时，再通过这个类来创建一个实例对象去使用这个插件。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// ./remove-comments-plugin.js
class RemoveCommentsPlugin {
  apply (compiler) {
    console.log('RemoveCommentsPlugin 启动')
    // compiler =&gt; 包含了我们此次构建的所有配置信息
  }
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>通过 compiler 对象的 hooks 属性访问到 emit 钩子，再通过 tap 方法注册一个钩子函数，这个方法接收两个参数：</p> <ul><li>第一个是插件的名称，我们这里的插件名称是 RemoveCommentsPlugin；</li> <li>第二个是要挂载到这个钩子上的函数；</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>// ./remove-comments-plugin.js
class RemoveCommentsPlugin {
  apply (compiler) {
    compiler.hooks.emit.tap('RemoveCommentsPlugin', compilation =&gt; {
      // compilation =&gt; 可以理解为此次打包的上下文
      for (const name in compilation.assets) {
        console.log(name) // 输出文件名称
      }
    })
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>文件内容需要通过遍历的值对象中的 source 方法获取，修改内容之后需要暴露一个 source 方法用来返回新的内容。另外还需要再暴露一个 size 方法，用来返回内容大小，这是 Webpack 内部要求的格式，具体如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// ./remove-comments-plugin.js
class RemoveCommentsPlugin {
  apply (compiler) {
    compiler.hooks.emit.tap('RemoveCommentsPlugin', compilation =&gt; {
      // compilation =&gt; 可以理解为此次打包的上下文
      for (const name in compilation.assets) {
        if (name.endsWith('.js')) {
          const contents = compilation.assets[name].source()
          const noComments = contents.replace(/\/\*{2,}\/\s?/g, '')
          compilation.assets[name] = {
            source: () =&gt; noComments,
            size: () =&gt; noComments.length
          }
        }
      }
    })
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="性能优化配置"><a href="#性能优化配置" class="header-anchor">#</a> 性能优化配置</h2> <h3 id="hmr"><a href="#hmr" class="header-anchor">#</a> HMR</h3> <p>HMR: hot module replacement 热模块替换 / 模块热替换
作用：一个模块发生变化，只会重新打包这一个模块（而不是打包所有模块）
devServer配置hot, 修改文件时刷新整个项目</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>devServer: {
    contentBase: resolve(__dirname, 'build'),
    compress: true,
    port: 3000,
    open: true,
    // 开启HMR功能
    // 当修改了webpack配置，新配置要想生效，必须重新webpack服务
    hot: true
  }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>样式文件：可以使用HMR功能：因为style-loader内部实现了~
js文件：默认不能使用HMR功能 --&gt; 需要修改js代码，添加支持HMR功能的代码
注意：HMR功能对js的处理，只能处理非入口js文件的其他文件。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>if (module.hot) {
  // 一旦 module.hot 为true，说明开启了HMR功能。 --&gt; 让HMR功能代码生效
  module.hot.accept('./print.js', function() {
    // 方法会监听 print.js 文件的变化，一旦发生变化，其他模块不会重新打包构建。
    // 会执行后面的回调函数
    print();
  });
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="source-map"><a href="#source-map" class="header-anchor">#</a> source-map</h3> <p>一种提供源代码到构建后代码映射技（如果构建后代码出错了，通过映射可以追踪源代码错误）</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>module.exports = {
    devtool: 'source-map'
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><table><thead><tr><th>devtool</th> <th>构建速度</th> <th>重新构建速度</th> <th>生产环境</th> <th>品质</th></tr></thead> <tbody><tr><td>(none)</td> <td>+++</td> <td>+++</td> <td>yes</td> <td>打包后的代码</td></tr> <tr><td>eval</td> <td>+++</td> <td>+++</td> <td>no</td> <td>生成后的代码</td></tr> <tr><td>cheap-eval-source-map</td> <td>+</td> <td>++</td> <td>no</td> <td>转换过的代码（仅限行）</td></tr> <tr><td>cheap-module-eval-source-map</td> <td>o</td> <td>++</td> <td>no</td> <td>原始源代码（仅限行）</td></tr> <tr><td>eval-source-map</td> <td>--</td> <td>+</td> <td>no</td> <td>原始源代码</td></tr> <tr><td>cheap-source-map</td> <td>+</td> <td>o</td> <td>no</td> <td>转换过的代码（仅限行）</td></tr> <tr><td>cheap-module-source-map</td> <td>o</td> <td>-</td> <td>no</td> <td>原始源代码（仅限行）</td></tr> <tr><td>inline-cheap-source-map</td> <td>+</td> <td>o</td> <td>no</td> <td>转换过的代码（仅限行）</td></tr> <tr><td>inline-cheap-module-source-map</td> <td>o</td> <td>-</td> <td>no</td> <td>原始源代码（仅限行）</td></tr> <tr><td>source-map</td> <td>--</td> <td>--</td> <td>yes</td> <td>原始源代码</td></tr> <tr><td>inline-source-map</td> <td>--</td> <td>--</td> <td>no</td> <td>原始源代码</td></tr> <tr><td>hidden-source-map</td> <td>--</td> <td>--</td> <td>yes</td> <td>原始源代码</td></tr> <tr><td>nosources-source-map</td> <td>--</td> <td>--</td> <td>yes</td> <td>无源代码内容</td></tr></tbody></table> <blockquote><p>+++ 非常快速, ++ 快速, + 比较快, o 中等, - 比较慢, -- 慢</p></blockquote> <h2 id="oneof"><a href="#oneof" class="header-anchor">#</a> oneOf</h2> <p>当规则匹配时，只使用第一个匹配规则
// 注意：不能有两个配置处理同一种类型文件</p> <h2 id="缓存"><a href="#缓存" class="header-anchor">#</a> 缓存</h2> <p>babel缓存，为改变的文件不会重复编译打包</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
    test: /\.js$/,
    exclude: /node_modules/,
    loader: &quot;babel-loader&quot;,
    options: {
        presets: [
            [
                '@babel/preset-env',
                {
                    useBuiltIns: 'usage',
                    corejs: { version: 3 },
                    targets: {
                        chrome: '60',
                        firefox: '50'
                    }
                }
            ]
        ],
        // 开启babel缓存
        // 第二次构建时，会读取之前的缓存
        cacheDirectory: true
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>文件缓存，浏览器获取文件并缓存，设置hase值，当文件改变hase改变缓存失效，获取最新文件。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>output: {
    filename: 'js/built.[contenthash:10].js',
    path: resolve(__dirname, 'build')
}
new MiniCssExtractPlugin({
      filename: 'css/built.[contenthash:10].css'
    }),
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>文件资源缓存</p> <ul><li>hash: 每次wepack构建时会生成一个唯一的hash值。<br>
问题: 因为js和css同时使用一个hash值。<br>
如果重新打包，会导致所有缓存失效。（可能我却只改动一个文件）</li> <li>chunkhash：根据chunk生成的hash值。如果打包来源于同一个chunk，那么hash值就一样<br>
问题: js和css的hash值还是一样的<br>
因为css是在js中被引入的，所以同属于一个chunk</li> <li>contenthash: 根据文件的内容生成hash值。不同文件hash值一定不一样</li></ul> <h2 id="tree-shaking"><a href="#tree-shaking" class="header-anchor">#</a> tree shaking</h2> <p>去除沒被使用的代码</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>前提：1. 必须使用ES6模块化  2. 开启production环境
    作用: 减少代码体积

    在package.json中配置 
      &quot;sideEffects&quot;: false 所有代码都没有副作用（都可以进行tree shaking）
        问题：可能会把css / @babel/polyfill （副作用）文件干掉
      &quot;sideEffects&quot;: [&quot;*.css&quot;, &quot;*.less&quot;]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="code-split-代码分割"><a href="#code-split-代码分割" class="header-anchor">#</a> code split 代码分割</h2> <p>方法一 根据入口文件代码分割（多入口）<br>
方法二 splitChunks</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>/*
    1. 可以将node_modules中代码单独打包一个chunk最终输出
    2. 自动分析多入口chunk中，有没有公共的文件。如果有会打包成单独一个chunk
  */
  optimization: {
    splitChunks: {
      chunks: 'all'
    }
  },
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>方法三 动态导入</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>/*
  通过js代码，让某个文件被单独打包成一个chunk
  import动态导入语法：能将某个文件单独打包
*/
import(/* webpackChunkName: 'test' */'./test')
  .then(({ mul, count }) =&gt; {
    // 文件加载成功~
    // eslint-disable-next-line
    console.log(mul(2, 5));
  })
  .catch(() =&gt; {
    // eslint-disable-next-line
    console.log('文件加载失败~');
  });
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="js文件懒加载"><a href="#js文件懒加载" class="header-anchor">#</a> js文件懒加载</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>document.getElementById('btn').onclick = function() {
  // 懒加载~：当文件需要使用时才加载~
  // 预加载 prefetch：会在使用之前，提前加载js文件 
  // 正常加载可以认为是并行加载（同一时间加载多个文件）  
  // 预加载 prefetch：等其他资源加载完毕，浏览器空闲了，再偷偷加载资源
  import(/* webpackChunkName: 'test', webpackPrefetch: true */'./test').then(({ mul }) =&gt; {
    console.log(mul(4, 5));
  });
};
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="pwa"><a href="#pwa" class="header-anchor">#</a> PWA</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>new WorkboxWebpackPlugin.GenerateSW({
      /*
        1. 帮助serviceworker快速启动
        2. 删除旧的 serviceworker

        生成一个 serviceworker 配置文件~
      */
      clientsClaim: true,
      skipWaiting: true
    })


/*
  1. eslint不认识 window、navigator全局变量
    解决：需要修改package.json中eslintConfig配置
      &quot;env&quot;: {
        &quot;browser&quot;: true // 支持浏览器端全局变量
      }
   2. sw代码必须运行在服务器上
      --&gt; nodejs
      --&gt;
        npm i serve -g
        serve -s build 启动服务器，将build目录下所有资源作为静态资源暴露出去
*/
// 注册serviceWorker
// 处理兼容性问题
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () =&gt; {
    navigator.serviceWorker
      .register('/service-worker.js')
      .then(() =&gt; {
        console.log('sw注册成功了~');
      })
      .catch(() =&gt; {
        console.log('sw注册失败了~');
      });
  });
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h2 id="多进程打包"><a href="#多进程打包" class="header-anchor">#</a> 多进程打包</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>/* 
    开启多进程打包。 
    进程启动大概为600ms，进程通信也有开销。
    只有工作消耗时间比较长，才需要多进程打包
*/
{
    loader: 'thread-loader',
    options: {
        workers: 2 // 进程2个
    }
},
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="externals-外部扩展"><a href="#externals-外部扩展" class="header-anchor">#</a> externals 外部扩展</h2> <p>防止将某些 import 的包(package)打包到bundle中，而是在运行时(runtime)再去从外部获取这些扩展依赖</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>externals: {
    // 拒绝jQuery被打包进来
    jquery: 'jQuery'
  }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="dll"><a href="#dll" class="header-anchor">#</a> dll</h2> <p>使用dll技术，对某些库（第三方库：jquery、react、vue...）进行单独打包</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// webpack.dll.js打包生成dll
module.exports = {
  entry: {
    // 最终打包生成的[name] --&gt; jquery
    // ['jquery'] --&gt; 要打包的库是jquery
    jquery: ['jquery'],
  },
  output: {
    filename: '[name].js',
    path: resolve(__dirname, 'dll'),
    library: '[name]_[hash]' // 打包的库里面向外暴露出去的内容叫什么名字
  },
  plugins: [
    // 打包生成一个 manifest.json --&gt; 提供和jquery映射
    new webpack.DllPlugin({
      name: '[name]_[hash]', // 映射库的暴露的内容名称
      path: resolve(__dirname, 'dll/manifest.json') // 输出文件路径
    })
  ],
  mode: 'production'
};
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>// webpack.config.js
module.exports = {
  entry: './src/index.js',
  output: {
    filename: 'built.js',
    path: resolve(__dirname, 'build')
  },
  plugins: [
    new HtmlWebpackPlugin({
      template: './src/index.html'
    }),
    // 告诉webpack哪些库不参与打包，同时使用时的名称也得变~
    new webpack.DllReferencePlugin({
      manifest: resolve(__dirname, 'dll/manifest.json')
    }),
    // 将某个文件打包输出去，并在html中自动引入该资源
    new AddAssetHtmlWebpackPlugin({
      filepath: resolve(__dirname, 'dll/jquery.js')
    })
  ],
  mode: 'production'
};
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h2 id="nopase"><a href="#nopase" class="header-anchor">#</a> noPase</h2> <p>忽略大型的 library 解析,提高构建性能。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>module: {
    noParse: /jquery|lodash/,
  }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="ignoreplugin"><a href="#ignoreplugin" class="header-anchor">#</a> ignorePlugin</h2> <p>忽略import、require的引入</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>new webpack.IgnorePlugin({
      resourceRegExp: /^\.\/locale$/,
      contextRegExp: /moment$/
    })
或者
new webpack.IgnorePlugin(/^\.\/locale$/,/moment$/)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/blogs/mongodb.html" class="prev">
            mongodb
          </a></span> <span class="next"><a href="/blogs/" class="router-link-active">
            zz
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:0;" data-v-70334359></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.243d9624.js" defer></script><script src="/assets/js/3.76c4d218.js" defer></script><script src="/assets/js/1.7654875a.js" defer></script><script src="/assets/js/13.6e4b38fe.js" defer></script>
  </body>
</html>
